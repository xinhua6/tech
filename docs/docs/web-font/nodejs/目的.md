# 目的

#### 为什么需要使用nodejs作为中间层
在实际的业务流程中，有些数据是从不同的业务系统中获取的，需要前端发送5,6个异步请求，此时我们可以在nodejs端使用Bigpiper技术，合并请求，降低负担，分批输出。


#### nodejs作为中间层可以做的
1. 代理：在开发环境下，我们可以利用代理来，解决最常见的跨域问题；在线上环境下，我们可以利用代理，转发请求到多个服务端。
2. 缓存：缓存其实是更靠近前端的需求，用户的动作触发数据的更新，node中间层可以直接处理一部分缓存需求。
3. 限流：node中间层，可以针对接口或者路由做响应的限流。
4. 日志：相比其他服务端语言，node中间层的日志记录，能更方便快捷的定位问题（是在浏览器端还是服务端）。
5. 监控：擅长高并发的请求处理，做监控也是合适的选项。
6. 鉴权：有一个中间层去鉴权，也是一种单一职责的实现。
7. 路由：前端更需要掌握页面路由的权限和逻辑。
8. 服务端渲染：node中间层的解决方案更灵活，比如SSR、模板直出、利用一些JS库做预渲染等等。



#### 中间层采取的框架模式
Nginx + nodejs + varnish + mongoDB
```
由nginx做接口转发、负载，varnish做数据缓存层，node是业务处理层，在4核服务器上启动4个node进程(跟cpu核数对应)，通过nginx的ip_hash做负载均衡，将请求均分给各个node进程，充分利用cpu的性能；node进程在收到请求后会通过内网调用发送http请求获取后端接口数据；varnish是一款高性能、开源的反向代理服务器和缓存服务器，我们在nginx跟node之间加了一层varnish缓存系统，通过配置在varnish缓存整条接口请求，减少相同请求的透传提高中间层服务性能。
```



### 参考
[爱奇艺PC Web Node.js 中间层实践](https://cloud.tencent.com/developer/article/1513512)